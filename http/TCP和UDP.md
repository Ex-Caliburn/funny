# TCP和UDP

## 前言

tcp: 传输控制协议,全拼:Transmission Control Protocol 它是一个面向连接，可靠的传输协议
udp: 用户数据报协议,全拼:User Datagram Protocol 它不是面向连接，不是可靠的传输协议, udp协议传输速度快

tcp和udp都是传输层的两个传输协议

### TCP

- 面向连接，间接验证对方ip的有效
- 可靠的传输
- 应答机制:发送数据包完成以后，对方收到数据底层会回复
- 超时重传:发送数据以后对方没有进行回复，会隔一段时间再次给对方发送数据，如果对方一直没有回复，那么会认为对方已经掉线了
- 错误校验:如果收到的数据和之前发送数据包的序号不一致，会自动根据需要进行排序，如果收到重复的数据包，会把重复的数据包删除
- 流量控制:使用tcp能保证接收数据的时候电脑不会卡死

### 对比

- 面向连接， udp不面向连接
- 能保证数据有效和有序的传输，udp保证不了
- 有超时重传，udp没有
- 有错误校验，如果出现数据包顺序不一致会自动排序，还有如果收到数据包重复会自动删除重复的数据包，udp没有
- 有流量控制 udp没有
- 需要建立连接然后需要资源开销要大， udp不需要建立连接资源开销小
- 适合发送大量的数据,tcp每次发送的数据包理论上没有上限控制，udp每次发送的数据包不能超过64k
- 应用场景: 文件上传和下载、浏览器上网，绝大多数应用程序都是用tcp协议，udp应用场景: 发送广播消息（飞秋上线），音视频传输（qq和微信），包括共屏软件
- 发送数据的时候需要建立连接，udp不需要建立连接，udp发送速度比tcp发送速度要快

### ping

ping命令是用来探测主机到主机之间是否可通信，如果不能ping到某台主机，表明不能和这台主机建立连接。ping命令是使用 IP 和网络控制信息协议 (ICMP)，因而没有涉及到任何传输协议(UDP/TCP) 和应用程序。它发送icmp回送请求消息给目的主机。

ICMP协议规定：目的主机必须返回ICMP回送应答消息给源主机。如果源主机在一定时间内收到应答，则认为主机可达。

## 总结

UDP使用尽最大努力交付，即不保证可靠交付

对于 QQ微信发送消息过程中既有TCP参与还有UDP 同时出现P2P

采用UDP协议，通过服务器中转方式。因此，现在的IP侦探在你仅仅跟对方发送聊天消息的时候是无法获取到IP的。大家都知道，UDP 协议是不可靠协议，它只管发送，不管对方是否收到的，但它的传输很高效。但是，作为聊天软件，怎么可以采用这样的不可靠方式来传输消息呢？于是，腾讯采用了上层协议来保证可靠传输：如果客户端使用UDP协议发出消息后，服务器收到该包，需要使用UDP协议发回一个应答包。如此来保证消息可以无遗漏传输。之所以会发生在客户端明明看到“消息发送失败”但对方又收到了这个消息的情况，就是因为客户端发出的消息服务器已经收到并转发成功，但客户端由于网络原因没有收到服务器的应答包引起的。

登陆采用TCP协议和HTTP协议，你和好友之间发送消息，主要采用UDP协议，内网传文件采用了P2P技术

### 参考文献

1. <https://blog.csdn.net/weixin_43788290/article/details/105895983>
