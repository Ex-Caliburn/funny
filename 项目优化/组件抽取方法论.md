# 组件抽取

## 前言

一直一来组件的抽取，都是在复用的次数超过两次 就提取出组件，没有系统的规则，什么组件可以抽取，该如何编写组件，编写组件如何考虑

### 组件类别

1. 基础组件不包含业务
2. 业务组件，包含基础组件
3. render组件
4. 纯html组件

### 数据传递方式

1. v-model
2. prop
3. provide
4. $parent, $children
5. bus 不推荐，不易维护
6. vuex 不推荐， 太重
7. 通过函数把修改父组件的方式传递下去 骚操作

### slot 插槽

合理利用slot 插槽，给用户最大自由权
一个默认的slot
配上具名slot，如 ele dialog，有个属性title，还有具名slot title

### $listener $props $attrs

### 动态组件

使用动态组件代替if-else
前提 prop和事件相同

### 思路

1. 区分基础组件还是业务组件
基础组件哪里都可以复用，业务组件有种种限制应用场景

2.抽象化

比如我把人抽象为组件，先分功能， 分为 手，腿，头，身体，五个基础部分，职责不同，不能互相替代

我设计一个腿组件
他有哪些特点，特点就是他的属性， 如颜色 长度，宽度，肌肉健壮程度，
它有些哪些行为，行为就是它的方法， 跑，跳，走路，蹲等

如果在继续颗粒化的，腿有大腿，小腿，脚， 再颗粒化  器官=> 组织 => 细胞

考虑未来拓展：
脚有了新的特性，比如可以变硬， 可以防水， 就有新的属性， 硬度和防水等级
脚有的新的方法，装上火箭筒，可以飞

抽象的程度决定了代码的复杂度和拓展性
按我们上面的顺序来试试，在这里我们能想到多少就写多少，功能设计上有考虑不足是很正常的，因为我确实就没想到啊！

像腿，还会有腿的形状， O型腿，各种腿，是否有腿毛，脚掌大小，总会有考虑不周的情况
属性定义好，考虑好属性的类型，和初始值，如腿的高度，是数值，最小必须大于1，最大有个上线， 是否有疾病，这是一个boolean值

### 何时抽取成组件

1. 该功能使用次数超过2， 预计未来可能会
2. 基础组件，抽取可以提升开发效率
3. 业务逻辑相对独立，多个场景复用
4. 性能考虑，全局维护一个组件实例，而不是每个页面访问该组件
5. html组件， js组件

### 父访子: $children

this.children获取的是一个数组类型, 它包括所有子组件对象

缺陷
通过$children访问子组件时, 是一个数组类型, 访问其中的子组件必须通过索引
当子组件过多, 或在子组件前新添加的了组件, 往往不能确认拿到目标子组件的索引值
有时候, 想获取明确的其中一个特定的组件时, 可以用$refs

### 父访子: $refs的使用

$refs 和 ref指令通常是一起 使用的
首先给, 目标子组件添加ref绑定一个id
其次在父组件中, 通过this.$refs.id就可以访问到该组件了

### 子访父: $parent

在子组件中访问父组件: $parent (尽量避免使用)
在子组件中访问根组件: $root (尽量避免使用)
注意事项
尽管 Vue 在开发中, 允许我们通过 $parent 来访问父组件, 但开发中尽量不要这么做
子组件尽量避免直接访问父组件的数据, 因为这样耦合度太高
如果我们将子组件放在另外一个组件之内，很可能该父组件没有对应的属性, 往往会引起问题。
另外, 更不好做的是通过$parent直接修改父组件的状态, 那么父组件中的状态将变得飘忽不定, 很不利于我的调试和维护

## 总结

1. 组件内部不做业务处理，事件抛出，给外部处理，子组件本身就不应该生成数据，即使生成，内部运作，不能传递外部
2. 慎用extend，mixins，vue3有 compositionApi
3. 多个组件相互配合，使用入侵成本少，副作用小的， $children或$refs ,$children
4. 如果后来加需求了，使得组件功能大改，不宜动原有组件，新建组件，只需复制必要属性和方法，而不是在原有组件if else 嵌套
5. 组件不可能适应所有的场景，预留slot，有可能slot都不能处理异常，这种可能需要修改组件，只能单独设计，不能修改原来的组件，不能为了 1%，动了 99%用户功能
6. 遵循组件书写顺序

### 参考文献

1. <https://cn.vuejs.org/v2/guide/components.html#%E5%8A%A8%E6%80%81%E7%BB%84%E4%BB%B6>
2. <https://zhuanlan.zhihu.com/p/265938545>
