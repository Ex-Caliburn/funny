## 定时器真是定时执行的么？

```
console.time(1);
setTimeout(() => {
  console.timeEnd(1);
}, 100);

var b = 1;
for (let i=0; i < 100000; i++) {
  for (let j=0; j < 1000; j++) {
    b = b * Math.random() *100;
  }
}
```
如预期，定时器并没有在100毫秒后执行,有时而是误差, 参数越大误差越大

这可以证明js是单线程的

### 进程(process)
程序的一次执行, 它占有一片独有的内存空间， 可以通过任务管理器查看进程

多进程运行: 一应用程序可以同时启动多个实例运行



###  线程(thread)
是进程内的一个独立执行单元
是程序执行的一个完整流程
是CPU的最小的调度单元

#### 单线程
优点: 顺序编程简单
缺点：效率低

####  多线程
 在一个进程内, 同时有多个线程运行
优点: 能有效提升CPU的利用率
缺点：创建多线程开销，线程切换开销， 死锁和同步问题

### 浏览器内核
不同浏览器内核不同
内核由很多模块组成

主线程
1. js引擎模块 : 负责js程序的编译与运行
2. html,css文档解析模块 : 负责页面文本的解析
3. DOM/CSS模块 : 负责dom/css在内存中的相关处理 
4. 布局和渲染模块 : 负责页面的布局和效果的绘制(内存中的对象)

分线程
1. 定时器模块 : 负责定时器的管理
2. 事件响应模块 : 负责事件的管理
3. 网络请求模块 : 负责服务器请求(常规/Ajax)
4. 等等

正因为单线程，所以加载js，会调用js 引擎模块，占用主线程，导致阻塞

#### 缺点
1. 慢
2. 不能跨域加载JS
3. worker内代码不能访问DOM(更新UI)
4. 不是每个浏览器都支持这个新特性

### 事件轮询机制
有一个执行栈 execution stack，所有的代码都是在此空间中执行的
js 是单线程，按顺序执行，我想也是为了最大程度利用线程 但是我们各种各样异步事件，所以我们有一个事件回调队列，

当执行栈的事件队列执行完时，事件轮询机制就会去回调消息队列中去寻找是否有可以执行的消息，每一个消息都关联着一个处理这个消息的回调函数，如果有则将最先进入队列的消息推入执行栈执行，函数的处理会一直进行到执行栈再次为空为止， 如果无，不断的轮询，直到主线程有事件发生或者回调队列有新事件

回调队列
1. 任务队列
2. 消息队列
3. 事件队列

优点：
每当一个消息完整地执行后，其他消息才会执行。它不会被抢占

缺点：
这个模型的一个缺点在于当一个消息需要太长时间才能处理完毕时，Web应用程序就无法处理与用户的交互，例如点击或滚动

### 再看setTimeout 添加消息
函数 setTimeout 接受两个参数：待加入队列的消息和一个时间值（可选，默认为 0）。这个时间值代表了消息被实际加入到队列的最小延迟时间。如果队列中没有其它消息并且栈为空，在这段延迟时间过去之后，消息会被马上处理。但是，如果有其它消息，setTimeout 消息必须等待其它消息处理完。因此第二个参数仅仅表示最少延迟时间，而非确切的等待时间。


### 永不阻塞
JavaScript的事件循环模型与许多其他语言不同的一个非常有趣的特性是，它永不阻塞。 处理 I/O 通常通过事件和回调来执行，所以当一个应用正等待一个 IndexedDB 查询返回或者一个 XHR 请求返回时，它仍然可以处理其它事情，比如用户输入。

由于历史原因有一些例外，如 alert 或者同步 XHR，但应该尽量避免使用它们。注意，例外的例外也是存在的（但通常是实现错误而非其它原因）。

### Web Workers
Web Workers 是 HTML5 提供的一个javascript多线程解决方案

web workers允许主脚本可以在其他线程运行其他脚本，设计完美的网站为了执行复杂或者冗长的操作，让主线程去执行简单的工作如更新，布局，渲染页面


### 参考文献
1. https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop
2. https://stackoverflow.com/questions/2734025/is-javascript-guaranteed-to-be-single-threaded/2734311#2734311
3. https://developer.mozilla.org/zh-CN/docs/Web/API/Window/setTimeout
4. https://developer.mozilla.org/en-US/docs/Web/API/HTML_DOM_API/Microtask_guide/In_depth