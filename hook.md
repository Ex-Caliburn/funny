# hook

## 前言

以前，React API 只有一套，现在有两套：类（class）API 和基于函数的钩子（hooks） API。

任何一个组件，可以用类来写，也可以用钩子来写。下面是类的写法。

```js
class Welcome extends React.Component {
  render() {
    return <h1>Hello, {this.props.name}</h1>;
  }
}
```

再来看钩子的写法，也就是函数。

```js

function Welcome(props) {
  return <h1>Hello, {props.name}</h1>;
}
```

这两种写法，作用完全一样。初学者自然会问："我应该使用哪一套 API？"

官方推荐使用钩子（函数），而不是类。因为钩子更简洁，代码量少，用起来比较"轻"，而类比较"重"。而且，钩子是函数，更符合 React 函数式的本质。

但是，钩子的灵活性太大，初学者不太容易理解。很多人一知半解，很容易写出混乱不堪、无法维护的代码。那就不如使用类了。因为类有很多强制的语法约束，不容易搞乱。

### 类和函数的差异

严格地说，类组件和函数组件是有差异的。不同的写法，代表了不同的编程方法论。

`类（class）是数据和逻辑的封装`。 也就是说，组件的状态和操作方法是封装在一起的。如果选择了类的写法，就应该把相关的数据和操作，都写在同一个 class 里面。

`函数一般来说，只应该做一件事，就是返回一个值`。 如果你有多个操作，每个操作应该写成一个单独的函数。而且，数据的状态应该与操作方法分离。根据这种理念，React 的函数组件只应该做一件事情：返回组件的 HTML 代码，而没有其他的功能。

```js
function Welcome(props) {
  return <h1>Hello, {props.name}</h1>;
}
```

这个函数只做一件事，就是根据输入的参数，返回组件的 HTML 代码。这种只进行单纯的数据计算（换算）的函数，在函数式编程里面称为 "纯函数"（pure function）。

### 副效应是什么？

看到这里，你可能会产生一个疑问：如果纯函数只能进行数据计算，那些不涉及计算的操作（比如生成日志、储存数据、改变应用状态等等）应该写在哪里呢？

函数式编程将那些跟数据计算无关的操作，都称为 `"副效应" （side effect）` 。如果函数内部直接包含产生副效应的操作，就不再是纯函数了，我们称之为不纯的函数。

![alt](https://www.wangbase.com/blogimg/asset/202009/bg2020091410.jpg)

纯函数内部只有通过间接的手段（即通过其他函数调用），才能包含副效应。

### 钩子（hook）的作用

说了半天，那么钩子到底是什么？

一句话，`钩子（hook）就是 React 函数组件的副效应解决方案，用来为函数组件引入副效应`。 函数组件的主体只应该用来返回组件的 HTML 代码，所有的其他操作（副效应）都必须通过钩子引入。

由于副效应非常多，所以钩子有许多种。React 为许多常见的操作（副效应），都提供了专用的钩子。

useState()：保存状态
useContext()：保存上下文
useRef()：保存引用
......
上面这些钩子，都是引入某种特定的副效应，而`useEffect()是通用的副效应钩子` 。找不到对应的钩子时，就可以用它。其实，从名字也可以看出来，它跟副效应（side effect）直接相关。

## 总结

### 参考文献

1. <https://www.ruanyifeng.com/blog/2020/09/react-hooks-useeffect-tutorial.html>
